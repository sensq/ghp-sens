/*	jscam <http://crocro.com/html5/jscam/wiki.cgi>
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
	in a Japanese translation <http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license>
	Copyright (c) 2012 Masakazu Yanai / (c) 2012 Cronus Crown <webmaster@crocro.com>
*/

if(typeof crocro=="undefined"){var crocro=function(){}}if(typeof crocro.jscam=="undefined"){crocro.jscam=function(){}}crocro.jscam.information={name:"crocro.jscam",descriptionJa:"JavaScriptでWebカメラの画像を取得するライブラリ",descriptionEn:"The library which operates a Web camera by JavaScript.",version:"1.0.0",versionMajor:"1",author:"Masakazu Yanai",publisher:"Cronus Crown",lastModified:"2012/01/19",url:"http://crocro.com/",urlDownload:"http://crocro.com/html5/jscam/wiki.cgi",copyright:"(c) 2012 Masakazu Yanai / (c) 2012 Cronus Crown"};crocro.jscam.option={};crocro.jscam.write=function(a){if(!a){a={}}var d={};var e={fps:8,dir:"",w:320,h:240};var g=[];for(var c in e){d[c]=e[c];if(c in a){d[c]=a[c]}g.push(c+"="+d[c])}crocro.jscam.option=d;var b=g.join("&");var f=[];f.push('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" 		codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" 		width="'+d.w+'" height="'+d.h+'" id="externalSwfCam" align="middle">');f.push('<param name="allowScriptAccess" value="always" />');f.push('<param name="allowFullScreen" value="false" />');f.push('<param name="movie" value="'+d.dir+'jscam.swf" />');f.push('<param name="quality" value="high" />');f.push('<param name="bgcolor" value="#cccccc" />');f.push('<param name="FlashVars" value="'+b+'" />');f.push('<embed src="'+d.dir+'jscam.swf" FlashVars="'+b+'"');f.push('quality="high" bgcolor="#ffffff" 		width="'+d.w+'" height="'+d.h+'" align="middle" 		name="externalSwfCam" allowScriptAccess="always" allowFullScreen="false" 		type="application/x-shockwave-flash" 		pluginspage="http://www.macromedia.com/go/getflashplayer" />');f.push("</object>");document.writeln(f.join("\n"))};crocro.jscam.getSwf=function(a){if(navigator.appName.indexOf("Microsoft")>=0&&new String(document[a]).indexOf("ObjectElement")<0){return window[a]}return document[a]};crocro.jscam.swfCam=null;crocro.jscam.initSwfCam=function(){var a=crocro.jscam.getSwf("externalSwfCam");a.enable=true;if(!window.HTMLCanvasElement){a.enable=false;alert("Don't use this browser.")}crocro.jscam.swfCam=a};crocro.jscam.callbackReady=null;crocro.jscam.ready=function(a){if(typeof a=="function"){crocro.jscam.callbackReady=a}};crocro.jscam.readyFromSwf=function(a){if(crocro.jscam.callbackReady){setTimeout(function(){crocro.jscam.callbackReady(a)},10)}};crocro.jscam.setFilter=function(b){var a=crocro.jscam.swfCam;try{if(a.checkEnable()){a.setFilter(b);return}}catch(c){}setTimeout(function(){crocro.jscam.setFilter(b)},1000)};crocro.jscam.setsetLabelCutOff=function(c,b){var a=crocro.jscam.swfCam;try{if(a.checkEnable()){a.setLabelCutOff(parseInt(c),parseInt(b));return}}catch(d){}setTimeout(function(){crocro.jscam.setsetLabelCutOff(c,b)},1000)};crocro.jscam.setDots=function(c){var a=crocro.jscam.swfCam;try{if(a.checkEnable()){a.setDots(c);return}}catch(b){}setTimeout(function(){crocro.jscam.setDots(c)},1000)};crocro.jscam.setMarker=function(c){var a=crocro.jscam.swfCam;try{if(a.checkEnable()){a.setMarker(c,c.length);return}}catch(b){}setTimeout(function(){crocro.jscam.setMarker(c,c.length)},1000)};crocro.jscam.setMarkerMatchThreshold=function(b){var a=crocro.jscam.swfCam;try{if(a.checkEnable()){a.setMarkerMatchThreshold(parseInt(b));return}}catch(c){}setTimeout(function(){crocro.jscam.setMarkerMatchThreshold(b)},1000)};crocro.jscam.CaptureObject=function(b){this.w=crocro.jscam.option.w;this.h=crocro.jscam.option.h;this.c=4;this.cnvsObj=document.getElementById(b);this.cntxtObj=this.cnvsObj.getContext("2d");this.cntxtImg=this.cntxtObj.getImageData(0,0,this.w,this.h);this.putImg=function(m){var k=this.cntxtImg.data;var h=this.w*this.h;var l=this.c;for(var f=0;f<h;f++){var e=f*l;var g=m[f];k[e]=(g>>16)&255;k[e+1]=(g>>8)&255;k[e+2]=g&255;k[e+3]=255}this.cntxtObj.putImageData(this.cntxtImg,0,0)};this.backDataTypes=["pixelSwf"];this.setBackDataType=function(c){if(c instanceof Array){this.backDataTypes=c}};this.id=b;this.callback="callback"+this.id;var a=this;this.extrFnc=null;this.setExtrFnc=function(c){this.extrFnc=c};(function(){crocro.jscam.CaptureObject[a.callback]=function(c){for(var d=0;d<c.length;d++){if(typeof c[d]==="undefined"){continue}if(c[d].name=="pixelSwf"||c[d].name=="pixelRaw"||c[d].name=="pixelBin"){a.putImg(c[d].data);break}}var e={};for(var d=0;d<c.length;d++){if(typeof c[d]==="undefined"){continue}e[c[d].name]=c[d].data}if(a.extrFnc){a.extrFnc(e)}if(a.onceCallBack){a.onceCallBack(e)}a.onceCallBack=null}})();this.onceCallBack=null;this.capture=function(d){a.onceCallBack=d;var c=crocro.jscam.swfCam;if(!c.enable){return}try{if(c.checkEnable()){c.captureCallback("crocro.jscam.CaptureObject."+a.callback,a.backDataTypes)}}catch(f){}};this.detect=function(d){a.onceCallBack=d;var c=crocro.jscam.swfCam;if(!c.enable){return}try{if(c.checkEnable()){c.detectCallback("crocro.jscam.CaptureObject."+a.callback,a.backDataTypes);return}}catch(f){}setTimeout(function(){a.detect(d)},200)};this.outputImage=function(e,d){var c=this.cnvsObj.toDataURL(d);document.getElementById(e).src=c}};crocro.jscam.makeCaptureObject=function(a){return new crocro.jscam.CaptureObject(a)};crocro.jscam.util=function(){};crocro.jscam.util.swapXY=function(c,d,b){var a,g;var f=new Array(c);for(a=0;a<c;a++){var e=new Array(g);for(g=0;g<d;g++){e[g]=b[g][a]}f[a]=e}return f};crocro.jscam.util.makeMarker=function(b,g,i,e,n){var j=g.length;var f=document.createElement("table");f.id=b+"Tbl";f.setAttribute("border",0);f.setAttribute("cellspacing",0);f.setAttribute("cellpadding",0);for(var k=0;k<j;k++){var h=document.createElement("tr");for(var m=0;m<j;m++){var c=g[m][k]==1?"black":"white";var l=b+"Tbl_"+m+"_"+k;var d=document.createElement("td");h.appendChild(d);var a=document.createElement("div");d.appendChild(a);a.style.width=i+"px";a.style.height=i+"px";a.style.background=c;a.style.overflow="hidden";a.style.color=c;a.id=l;if(e){a.addEventListener("click",(function(o,p){return function(){var q=1-this.innerHTML*1;this.innerHTML=q;this.style.background=this.style.color=q?"black":"white";if(typeof n=="function"){n(o,p,q)}}})(m,k))}a.innerHTML=g[m][k]}f.appendChild(h)}document.getElementById(b).appendChild(f)};crocro.jscam.util.makeDots=function(c,g,m,e,p){var j=g.length;var f=document.createElement("table");f.id=c+"Tbl";f.setAttribute("border",0);f.setAttribute("cellspacing",0);f.setAttribute("cellpadding",0);var h=parseInt(m*0.8);var l=parseInt(m*0.35);for(var k=0;k<j;k++){var i=document.createElement("tr");for(var o=0;o<j;o++){var a=g[o][k]==1?h:l;var n=c+"Tbl_"+o+"_"+k;var d=document.createElement("td");d.setAttribute("align","center");d.setAttribute("valign","middle");d.style.background="white";d.style.width=m+"px";d.style.height=m+"px";i.appendChild(d);var b=document.createElement("div");d.appendChild(b);b.style.width=a+"px";b.style.height=a+"px";b.style.background="black";b.style.overflow="hidden";b.style.color="black";b.id=n;if(e){b.addEventListener("click",(function(q,r){return function(){var s=1-this.innerHTML*1;this.innerHTML=s;var t=s==1?h:l;this.style.width=t+"px";this.style.height=t+"px";if(typeof p=="function"){p(q,r,s)}}})(o,k))}b.innerHTML=g[o][k]}f.appendChild(i)}document.getElementById(c).appendChild(f)};